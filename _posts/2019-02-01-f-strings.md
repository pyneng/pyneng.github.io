---
title: "Форматирование строк с помощью f-strings"
date: 2019-02-01
tags:
 - lecture
category:
 - pyneng-6
---


В Python существует несколько способов форматирования строк: [старый вариант форматирования с `%`](https://natenka.gitbook.io/pyneng/part_i/04_data_structures/4_strings/4b_string_format#formatirovanie-strok-s-operatorom), [форматирование с помощью метода format](https://natenka.gitbook.io/pyneng/part_i/04_data_structures/4_strings/4b_string_format#formatirovanie-strok-s-metodom-format) и использование string.Template.
Кроме того, к форматированию строк можно условно отнести сложение отдельных строк в одно целое.

В Python 3.6 добавился новый вариант форматирования строк - f-строки или интерполяция строк.
F-строки позволяют не только подставлять какие-то значения в шаблон, но и позволяют выполнять  вызовы функций, методов и тп.

Во многих ситуациях f-строки удобней и проще использовать, чем format, кроме того, f-строки работают быстрее, чем format и другим методы форматирования строк.

## Синтаксис

F-строки - это литерал строки с буквой `f` перед ним. Внутри f-строки в паре фигурных скобок указываются имена переменных, которые надо подставить:
```python
In [1]: ip = '10.1.1.1'

In [2]: mask = 24

In [3]: f"IP: {ip}, mask: {mask}"
Out[3]: 'IP: 10.1.1.1, mask: 24'
```

> Аналогичный результат с format можно получить так: `"IP: {ip}, mask: {mask}".format(ip=ip, mask=mask)`.

Очень важное отличие f-строк от format: f-строки это выражение, которое выполняется, а не просто строка.
То есть, в случае с ipython, как только мы написали выражение и нажали Enter, оно выполнилось и вместо выражений `{name}` и `{mask}` подставились значения переменных.

Поэтому, например, нельзя сначала написать шаблон, а затем определить переменные, которые используются в шаблоне:
```python
In [1]: f"IP: {ip}, mask: {mask}"
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-1-e6f8e01ac9c4> in <module>()
----> 1 f"IP: {ip}, mask: {mask}"

NameError: name 'ip' is not defined
```

Кроме подстановки значений переменных, в фигурных скобках можно писать выражения:
```python
In [1]: octets = ['10', '1', '1', '1']

In [2]: mask = 24

In [3]: f"IP: {'.'.join(octets)}, mask: {mask}"
Out[3]: 'IP: 10.1.1.1, mask: 24'
```

После двоеточия в f-строках можно указывать те же значения, что и при использовании format:
```python
In [9]: oct1, oct2, oct3, oct4 = [10, 1, 1, 1]

In [10]: print(f'''
    ...: IP address:
    ...: {oct1:<8} {oct2:<8} {oct3:<8} {oct4:<8}
    ...: {oct1:08b} {oct2:08b} {oct3:08b} {oct4:08b}''')

IP address:
10       1        1        1
00001010 00000001 00000001 00000001
```

## Особенности использования f-строк

При использовании f-строк нельзя сначала создать шаблон, а затем его использовать, как при использовании format.

F-строка сразу выполняется и в нее подставляются значения переменных, которые должны быть определены ранее:
```python
In [7]: ip = '10.1.1.1'

In [8]: mask = 24

In [9]: print(f"IP: {ip}, mask: {mask}")
IP: 10.1.1.1, mask: 24
```

Если необходимо подставить другие значения, надо создать новые переменные и снова написать f-строку:
```python
In [11]: ip = '10.2.2.2'

In [12]: mask = 24

In [13]: ip = '10.2.2.2'

In [14]: print(f"IP: {ip}, mask: {mask}")
IP: 10.2.2.2, mask: 24
```

Использование f-строк в таком случае может быть не очень удобным, особенно если надо будет изменить f-строку, в таком случае вручную надо будет менять и вторую. 

При использовании f-строк в циклах, f-строку надо писать в теле цикла, чтобы она "подхватывала" новые значения переменных на каждой итерации:
```
In [1]: ip_list = ['10.1.1.1/24', '10.2.2.2/24', '10.3.3.3/24']

In [2]: for ip_address in ip_list:
   ...:     ip, mask = ip_address.split('/')
   ...:     print(f"IP: {ip}, mask: {mask}")
   ...:
IP: 10.1.1.1, mask: 24
IP: 10.2.2.2, mask: 24
IP: 10.3.3.3, mask: 24
```



### Дополнительные ресурсы

* [Python 3's f-Strings: An Improved String Formatting Syntax (Guide)](https://realpython.com/python-f-strings/)
* [Python String Formatting Best Practices](https://realpython.com/python-string-formatting/)


